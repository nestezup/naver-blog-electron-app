<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Blog</title>
    <!-- Tailwind CSS v4 + DaisyUI (local) -->
    <link href="./css/style.css" rel="stylesheet" type="text/css" />
    <style>
        body { overflow: hidden; margin: 0; padding: 0; }
        webview { width: 100%; height: 100%; border: none; }
        .webview-container { position: relative; overflow: hidden; flex: 1; min-height: 0; }
        #loadingOverlay { position: absolute; inset: 0; background: white; z-index: 10; }
        #loadingOverlay.hidden { display: none; }
        .loading-spinner {
            width: 2rem; height: 2rem;
            border: 2px solid #e5e7eb; border-top: 2px solid #3b82f6;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* 높이 문제 해결 - 명확한 레이아웃 */
        body .main-container {
            height: calc(100vh - 4rem);
            display: flex;
        }
        body .sidebar {
            width: 320px;
            flex-shrink: 0;
            display: block;
            position: relative;
            transform: none;
        }
        body .webview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        .webview-section {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        webview {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="h-screen flex flex-col bg-base-100">
    <!-- Header -->
    <div class="navbar bg-primary text-primary-content">
        <div class="navbar-start">
            <button id="toggleSidebar" class="btn btn-ghost btn-circle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        <div class="navbar-center">
            <span class="text-xl font-bold">Naver Blog</span>
        </div>
        <div class="navbar-end">
            <button id="toggleTheme" class="btn btn-ghost btn-circle">
                <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-base-200">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">블로그 관리</h2>
            </div>
            <!-- Firebase 인증 -->
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">Firebase 인증</h3>
                <div id="firebaseAuthSection">
                    <div id="firebaseUserInfo" class="hidden mb-3">
                        <div class="flex items-center gap-2 mb-2">
                            <img id="userAvatar" class="w-8 h-8 rounded-full" src="" alt="User Avatar">
                            <div>
                                <div id="userDisplayName" class="text-sm font-medium"></div>
                                <div id="userEmail" class="text-xs text-gray-600"></div>
                            </div>
                        </div>
                    </div>
                    <div id="firebaseAuthButtons" class="space-y-2">
                        <button id="googleSignInBtn" class="btn btn-sm btn-outline w-full">
                            <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Google 로그인
                        </button>
                        <button id="emailSignInBtn" class="btn btn-sm btn-outline w-full">이메일 로그인</button>
                        <button id="emailSignUpBtn" class="btn btn-sm btn-outline w-full">회원가입</button>
                    </div>
                    <button id="firebaseSignOutBtn" class="btn btn-sm btn-error w-full hidden">로그아웃</button>
                </div>
            </div>

            <div class="p-4 border-b">
                <div class="flex items-center gap-3 mb-2">
                    <div id="loginStatus" class="w-3 h-3 rounded-full bg-error"></div>
                    <span id="loginText" class="text-sm">로그인되지 않음</span>
                </div>
                <button id="refreshCookies" class="btn btn-xs btn-outline">쿠키 새로고침</button>
            </div>
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">내 블로그 설정</h3>
                <div class="space-y-2">
                    <input
                        id="blogIdInput"
                        type="text"
                        placeholder="블로그 ID (예: nest4000)"
                        class="input input-sm w-full"
                        value="">
                    <div class="flex gap-1">
                        <button id="saveBlogId" class="btn btn-xs btn-primary flex-1">저장</button>
                        <button id="goToMyBlog" class="btn btn-xs btn-outline flex-1">내 블로그</button>
                    </div>
                </div>
            </div>
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">글 작성</h3>
                <div class="space-y-2">
                    <textarea
                        id="markdownInput"
                        placeholder="마크다운 내용을 입력하세요..."
                        class="textarea textarea-sm w-full h-32 resize-none"
                        rows="6"></textarea>

                    <!-- 링크 처리 옵션 -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text text-xs font-medium">링크 처리 방식</span>
                        </label>
                        <select id="linkProcessingOption" class="select select-sm select-bordered w-full">
                            <option value="upconvert">Upconvert API (권장)</option>
                            <option value="simple">단순 텍스트 링크</option>
                            <option value="oglink">OGLink 카드</option>
                        </select>
                    </div>

                    <div class="flex gap-2">
                        <button id="previewMarkdown" class="btn btn-sm btn-outline flex-1">미리보기</button>
                        <button id="createPostFromMarkdown" class="btn btn-sm btn-primary flex-1">마크다운으로 작성</button>
                    </div>
                </div>
            </div>
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">샘플 테스트</h3>
                <div class="space-y-3">
                    <button id="createSamplePost" class="btn btn-success w-full py-3 text-base font-medium">샘플 글 작성</button>
                    <button id="createSamplePostWithMarkdown" class="btn btn-info w-full py-3 text-base font-medium">마크다운 샘플 작성</button>
                </div>
            </div>
            <div class="p-4">
                <ul class="menu">
                    <li><a id="createPost" href="#" class="cursor-pointer">테스트 글 작성</a></li>
                    <li><a>글 목록</a></li>
                    <li><a>설정</a></li>
                </ul>
            </div>
        </div>

        <!-- WebView Container -->
        <div class="webview-container">
            <!-- Navigation -->
            <div class="bg-base-200 px-4 py-3 flex items-center gap-3 border-b">
                <button id="goBack" class="btn btn-sm btn-ghost px-3">←</button>
                <button id="goForward" class="btn btn-sm btn-ghost px-3">→</button>
                <button id="refresh" class="btn btn-sm btn-ghost px-3">↻</button>
                <div class="flex-1 mx-4">
                    <input id="urlInput" type="text" class="input input-sm w-full" value="https://blog.naver.com" readonly>
                </div>
            </div>

            <!-- WebView -->
            <div class="webview-section">
                <div id="loadingOverlay" class="flex items-center justify-center">
                    <div class="text-center">
                        <div class="loading-spinner mb-4"></div>
                        <p>네이버 블로그 로딩 중...</p>
                    </div>
                </div>
                <webview
                    id="blogWebview"
                    src="https://blog.naver.com"
                    nodeintegration="false"
                    webSecurity="true"
                    partition="persist:naver-blog">
                </webview>
            </div>
        </div>
    </div>

    <!-- 이메일 로그인/회원가입 모달 -->
    <div id="emailAuthModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-base-100 rounded-lg p-6 w-96 max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 id="emailAuthModalTitle" class="text-lg font-semibold">이메일 로그인</h3>
                <button id="closeEmailAuthModal" class="btn btn-sm btn-circle btn-ghost">✕</button>
            </div>

            <form id="emailAuthForm" class="space-y-4">
                <div>
                    <label class="label">
                        <span class="label-text">이메일</span>
                    </label>
                    <input
                        type="email"
                        id="emailInput"
                        class="input input-bordered w-full"
                        placeholder="your@email.com"
                        required
                    >
                </div>

                <div>
                    <label class="label">
                        <span class="label-text">비밀번호</span>
                    </label>
                    <input
                        type="password"
                        id="passwordInput"
                        class="input input-bordered w-full"
                        placeholder="비밀번호"
                        required
                    >
                </div>

                <div id="confirmPasswordDiv" class="hidden">
                    <label class="label">
                        <span class="label-text">비밀번호 확인</span>
                    </label>
                    <input
                        type="password"
                        id="confirmPasswordInput"
                        class="input input-bordered w-full"
                        placeholder="비밀번호 확인"
                    >
                </div>

                <div id="emailAuthMessage" class="hidden">
                    <div class="alert alert-info">
                        <span id="emailAuthMessageText"></span>
                    </div>
                </div>

                <button type="submit" id="emailAuthSubmitBtn" class="btn btn-primary w-full">
                    로그인
                </button>

                <div class="text-center">
                    <button type="button" id="forgotPasswordBtn" class="btn btn-link btn-sm">
                        비밀번호를 잊으셨나요?
                    </button>
                </div>
            </form>

            <div class="mt-4 pt-4 border-t">
                <div class="text-center text-sm">
                    <span id="authModeSwitchText">계정이 없으신가요?</span>
                    <button id="authModeSwitchBtn" class="btn btn-link btn-sm">회원가입</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./js/app.js"></script>
</body>
</html>