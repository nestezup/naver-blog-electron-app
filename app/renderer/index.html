<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' blob: data: https://* http://*; script-src 'self' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' blob: data: https://* http://*; font-src 'self' data:; connect-src 'self' blob: data: https://* http://*; frame-src 'self' https://* http://*;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Blog</title>
    <!-- Tailwind CSS v4 + DaisyUI (local build) -->
    <link href="./css/style.css" rel="stylesheet" type="text/css" />
    <script src="./assets/firebase-app-compat.js"></script>
    <script src="./assets/firebase-auth-compat.js"></script>
    <script src="./js/firebase-auth.js"></script>
</head>
    <!-- Header -->
    <div class="navbar bg-primary text-primary-content">
        <div class="navbar-start">
            <button id="toggleSidebar" class="btn btn-ghost btn-circle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        <div class="navbar-center">
            <span class="text-xl font-bold">Naver Blog</span>
        </div>
        <div class="navbar-end">
            <button id="userProfileBtn" class="btn btn-ghost btn-circle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </button>
            <button id="logoutBtn" class="btn btn-ghost btn-circle" title="로그아웃">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-base-200">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">블로그 관리</h2>
            </div>

            <div class="p-4 border-b space-y-3">
                <div class="flex items-center gap-3">
                    <div id="loginStatus" class="w-3 h-3 rounded-full bg-error"></div>
                    <span id="loginText" class="text-sm">로그인되지 않음</span>
                </div>
                <div class="bg-base-200 rounded-lg p-3 text-sm">
                    <p class="text-xs text-gray-500 uppercase tracking-wide">내 블로그 ID</p>
                    <p id="sidebarBlogId" class="font-semibold mt-1">미설정</p>
                    <p class="text-xs text-gray-500 mt-1">사용자 정보에서 관리됩니다.</p>
                    <button id="goToMyBlog" class="btn btn-xs btn-outline w-full mt-3">내 블로그 열기</button>
                </div>
            </div>
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">글 작성</h3>
                <div class="space-y-2">
                    <textarea
                        id="markdownInput"
                        placeholder="마크다운 내용을 입력하세요..."
                        class="textarea textarea-sm w-full h-32 resize-none"
                        rows="6"></textarea>

                    <!-- 링크 처리 옵션 -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text text-xs font-medium">링크 처리 방식</span>
                        </label>
                        <select id="linkProcessingOption" class="select select-sm select-bordered w-full">
                            <option value="upconvert">Upconvert API (권장)</option>
                            <option value="simple">단순 텍스트 링크</option>
                            <option value="oglink">OGLink 카드</option>
                        </select>
                    </div>

                    <button id="createPostFromMarkdown" class="btn btn-sm btn-primary w-full">마크다운으로 작성</button>
                </div>
            </div>
            <div class="p-4 border-b">
                <h3 class="text-sm font-semibold mb-2">샘플 테스트</h3>
                <div class="space-y-3">
                    <button id="createSamplePost" class="btn btn-success w-full py-3 text-base font-medium">샘플 글 작성</button>
                    <button id="createSamplePostWithMarkdown" class="btn btn-info w-full py-3 text-base font-medium">마크다운 샘플 작성</button>
                </div>
            </div>
            <div class="p-4">
                <ul class="menu">
                    <li><a id="createPost" href="#" class="cursor-pointer">테스트 글 작성</a></li>
                    <li><a>글 목록</a></li>
                    <li><a>설정</a></li>
                </ul>
            </div>
        </div>

        <!-- WebView Container -->
        <div class="webview-container">
            <!-- Navigation -->
            <div class="bg-base-200 px-4 py-3 flex items-center gap-3 border-b">
                <button id="goBack" class="btn btn-sm btn-ghost px-3">←</button>
                <button id="goForward" class="btn btn-sm btn-ghost px-3">→</button>
                <button id="refresh" class="btn btn-sm btn-ghost px-3">↻</button>
                <div class="flex-1 mx-4">
                    <input id="urlInput" type="text" class="input input-sm w-full" value="https://blog.naver.com" readonly>
                </div>
            </div>

            <!-- WebView -->
            <div class="webview-section">
                <div id="loadingOverlay" class="flex items-center justify-center">
                    <div class="text-center">
                        <div class="loading-spinner mb-4"></div>
                        <p>네이버 블로그 로딩 중...</p>
                    </div>
                </div>
                <webview
                    id="blogWebview"
                    src="https://blog.naver.com"
                    nodeintegration="false"
                    webSecurity="true"
                    partition="persist:naver-blog">
                </webview>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="userProfileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-base-100 rounded-lg p-6 w-96 max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">사용자 정보</h3>
                <button id="closeUserProfileModal" class="btn btn-sm btn-circle btn-ghost">✕</button>
            </div>

            <div id="userProfileContent" class="space-y-4">
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-3">
                        <svg class="w-8 h-8 text-primary-content" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold">Firebase 인증 사용자</h4>
                    <p class="text-sm text-gray-600">인증된 상태입니다</p>
                </div>

                <div class="divider"></div>

                <div class="space-y-3">
                    <div class="bg-base-200 rounded-lg p-3 text-sm text-left space-y-2">
                        <div>
                            <p class="text-xs text-gray-500 uppercase tracking-wide">내 블로그 ID</p>
                            <p id="profileBlogIdValue" class="text-base font-semibold mt-1">미설정</p>
                            <p class="text-xs text-gray-500 mt-1">Firebase 계정별로 저장됩니다.</p>
                        </div>
                        <button id="editBlogIdBtn" class="btn btn-sm btn-outline w-full">블로그 ID 설정</button>
                        <button id="globalRefreshCookies" class="btn btn-sm btn-ghost w-full text-xs text-gray-500">쿠키 새로고침</button>
                    </div>

                    <button id="authLogoutBtn" class="btn btn-error w-full">
                        로그아웃
                    </button>
                    <button id="closeProfileBtn" class="btn btn-outline w-full">
                        닫기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="blogIdModal" class="modal hidden">
        <div class="modal-box">
            <h3 class="font-bold text-lg">블로그 ID 설정</h3>
            <p class="py-4">영문, 숫자, -, _ 만 사용할 수 있습니다.</p>
            <input id="blogIdModalInput" type="text" class="input input-bordered w-full" />
            <div class="modal-action">
                <button id="blogIdModalCancel" class="btn">취소</button>
                <button id="blogIdModalSave" class="btn btn-primary">저장</button>
            </div>
        </div>
    </div>

    <script src="./js/app.js"></script>
</body>
</html>
